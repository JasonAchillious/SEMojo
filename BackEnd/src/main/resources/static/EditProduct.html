<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.14.0/theme-chalk/index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="EditProduct.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
<div id="app" class="fullscreen">
    <el-container>
        <el-header>
            <div align="left" style="width:100%;">
                <div align="left" style="width:55%; display:inline-block;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="homepage.html">
                        <img border="0" src="./picture/logo.png" style="height:45px; width:75px"/>
                        <p class=navigation_fontsize style="color:#FFFFFF; width:15%; display:inline-block;">SEMojo</p>
                    </a>
                    <el-link
                            href="product.html"
                            target="_blank"
                            style="color:#FFFFFF; text-decoration:none; width:10%"
                            class=navigation_fontsize
                    >Products
                    </el-link>
                    <el-link
                            href="support.html"
                            target="_blank"
                            style="color:#FFFFFF; text-decoration:none; width:10%"
                            class=navigation_fontsize
                    >Support
                    </el-link>
                    <el-link
                            href="forum.html"
                            target="_blank"
                            style="color:#FFFFFF; text-decoration:none; width:10%"
                            class=navigation_fontsize
                    >Forum
                    </el-link>
                </div>

                <div align="right" style="width:40%; display:inline-block">
                    <el-input
                            placeholder="Search SEMojo"
                            v-model="search"
                            class="input-with-select"
                            style="width: 40%">
                        <el-button slot="append" icon="el-icon-search"></el-button>
                    </el-input>
                    <el-link
                            href="login.html"
                            target="_blank"
                            style="color:#FFFFFF; width:15%;text-decoration:none"
                            class=navigation_fontsize
                    >Sign in
                    </el-link>
                    <el-link
                            href="signup.html"
                            :underline="false">
                        <el-button type="primary">Sign up</el-button>
                    </el-link>
                </div>
            </div>

        </el-header>

        <el-container>
            <el-aside width="40%">
                <div class="part">
                    <div class="title">
                        <div class="productName" v-bind:class="product.name">
                            <h1>{{product.name}}</h1>
                        </div>

                        <div style="display: block;width:40%;margin-left:8%;margin-top: 7%;margin-bottom: 6%">
                            <el-button type="primary" size="mini" v-on:click="editInfo">EDIT PROFILE</el-button>
                        </div>

                        <el-dialog title="Profile" :visible.sync="profileVisible">
                            <el-form class="product" ref="form" :model="edit" size="mini">
                                <el-form-item label="">
                                    <el-input v-model="edit.name" placeholder="Product Name">
                                        <template slot="prepend">Product Name</template>
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="">
                                    <el-input v-model="edit.contributor" placeholder="Contributor">
                                        <template slot="prepend">Contributor</template>
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="">
                                    <el-input v-model="edit.tags" placeholder="Product Tags">
                                        <template slot="prepend">Tags</template>
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="">
                                    <el-input v-model="edit.status" placeholder="Product Status">
                                        <template slot="prepend">Status</template>
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="">
                                    <el-input v-model="edit.description" placeholder="Description">
                                        <template slot="prepend">Description</template>
                                    </el-input>
                                </el-form-item>


                                <el-form-item size="large">
                                    <el-button type="primary" @click="submit">Save</el-button>
                                    <el-button type="info" @click="cancel">Cancel</el-button>
                                </el-form-item>
                            </el-form>
                        </el-dialog>
                    </div>

                    <div class="information">
                        <div class="info" style="display: block;margin-top:2%;line-height:10px;font-size: 8px;">
                            <p><b>Current Price: </b>{{product.currentPrice}}</p>
                            <p><s><b>Price: </b>{{product.price}}</s></p>
                            <p><b>Rating: </b>{{product.rating}}</p>
                            <p><b>Contributor: </b>{{product.contributor}}</p>
                            <p><b>Tags: </b>{{product.tags}}</p>
                            <p><b>Status: </b>{{product.status}}</p>
                            <p><b>Sale Volumn: </b>{{product.saleVolume}}</p>
                            <p><b>Release Data: </b>{{product.releaseDate}}</p>
                            <p><b>Recent Update Date: </b>{{product.recentUpdateDate}}</p>
                            <p><b>Description: </b>{{product.description}}</p>
                        </div>
                    </div>
                </div>


            </el-aside>

            <el-main>
                <div style="width:90%">
                <el-tabs v-model="activeName" @tab-click="handleClick">
                    <el-tab-pane label="Artifact" name="first">
                        <div class="products">
                            <div style="display: flex;">
                                <div style="width: 20%;display: flex;margin-left: 85%;margin-bottom: 10px">
                                    <el-button type="success" size="mini" @click="clickAdd()">Add</el-button>
                                </div>
                            </div>
                            <div class="show-products">
                                <ul class="list">
                                    <li class="list-item" v-for="artifact in artifacts">
                                        <div style="display: block;margin-left:5%;margin-top:2%;width: 60%">
                                            <h1 style="font-size: 1.5rem;display:table-cell;"><a
                                                    v-bind:href="artifact.url">{{artifact.name}}</a></h1>
                                        </div>
                                        <div style="flex: right;display: block;width:40%;margin-left:15%;margin-top: 6px;margin-bottom: 5px">
                                            <el-button type="primary" size="mini">Update</el-button>
                                            <el-button type="plain" size="mini">Delete</el-button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Source Code" name="second">
                        <div class="products">
                            <div style="display: flex;">
                                <div style="width: 20%;display: flex;margin-left: 85%;margin-bottom: 10px">
                                    <el-button type="success" size="mini" @click="clickAdd()">Add</el-button>
                                </div>
                            </div>
                            <div class="show-products">
                                <ul class="list">
                                    <li class="list-item" v-for="code in codes">
                                        <div style="display: block;margin-left:5%;margin-top:2%;width: 60%">
                                            <h1 style="font-size: 1.5rem;display:table-cell;"><a
                                                    v-bind:href="code.url">{{code.name}}</a></h1>
                                        </div>
                                        <div style="flex: right;display: block;width:40%;margin-left:15%;margin-top: 6px;margin-bottom: 5px">
                                            <el-button type="primary" size="mini">Update</el-button>
                                            <el-button type="plain" size="mini">Delete</el-button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Test Case" name="third">
                        <div class="products">
                            <div style="display: flex;">
                                <div style="width: 20%;display: flex;margin-left: 85%;margin-bottom: 10px">
                                    <el-button type="success" size="mini" @click="clickAddCode()">Add</el-button>
                                </div>
                            </div>
                            <div class="show-products">
                                <ul class="list">
                                    <li class="list-item" v-for="test in tests">
                                        <div style="display: block;margin-left:5%;margin-top:2%;width: 60%">
                                            <h1 style="font-size: 1.5rem;display:table-cell;"><a
                                                    v-bind:href="test.url">{{test.name}}</a></h1>
                                        </div>
                                        <div style="flex: right;display: block;width:40%;margin-left:15%;margin-top: 6px;margin-bottom: 5px">
                                            <el-button type="primary" size="mini">Update</el-button>
                                            <el-button type="plain" size="mini">Delete</el-button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Documents" name="fourth">
                        <div class="products">
                            <div style="display: flex;">
                                <div style="width: 20%;display: flex;margin-left: 85%;margin-bottom: 10px">
                                    <el-button type="success" size="mini" @click="clickAddCode()">Add</el-button>
                                </div>
                            </div>
                            <div class="show-products">
                                <ul class="list">
                                    <li class="list-item" v-for="document in documents">
                                        <div style="display: block;margin-left:5%;margin-top:2%;width: 60%">
                                            <h1 style="font-size: 1.5rem;display:table-cell;"><a
                                                    v-bind:href="document.url">{{document.name}}</a></h1>
                                        </div>
                                        <div style="flex: right;display: block;width:40%;margin-left:15%;margin-top: 6px;margin-bottom: 5px">
                                            <el-button type="primary" size="mini">Update</el-button>
                                            <el-button type="plain" size="mini">Delete</el-button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </el-tab-pane>
                    <el-tab-pane label="Others" name="fifth">
                        <div class="products">
                            <div style="display: flex;">
                                <div style="width: 20%;display: flex;margin-left: 85%;margin-bottom: 10px">
                                    <el-button type="success" size="mini" @click="clickAddCode()">Add</el-button>
                                </div>
                            </div>
                            <div class="show-products">
                                <ul class="list">
                                    <li class="list-item" v-for="other in others">
                                        <div style="display: block;margin-left:5%;margin-top:2%;width: 60%">
                                            <h1 style="font-size: 1.5rem;display:table-cell;"><a
                                                    v-bind:href="other.url">{{other.name}}</a></h1>
                                        </div>
                                        <div style="flex: right;display: block;width:40%;margin-left:15%;margin-top: 6px;margin-bottom: 5px">
                                            <el-button type="primary" size="mini">Update</el-button>
                                            <el-button type="plain" size="mini">Delete</el-button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </el-tab-pane>
                </el-tabs>

                    <!--上传code文件-->
                    <el-dialog title="Uploads Files" :visible.sync="dialogCodeVisible">
                        <el-form :model="codeForm">
                            <el-form-item label="活动名称" :label-width="formLabelWidth">
                                <el-input v-model="codeForm.name" autocomplete="off"></el-input>
                            </el-form-item>

                        </el-form>
                    </el-dialog>
                </div>
            </el-main>
        </el-container>
    </el-container>
</div>

<!-- import Vue before Element -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
<!-- import JavaScript -->
<script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.14.0/index.js"></script>

<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>

<script src="https://lib.baomitu.com/vuex/2.0.0/vuex.js"></script>

<script src="https://cdn.bootcss.com/qs/6.7.0/qs.min.js"></script>


<script>
    var qs = Qs;
    const store = new Vuex.Store({
        state: {
            token:'',  //初始化token
            username:''  //初始化username
        },
        mutations: {
            //存储token方法
            //设置token等于外部传递进来的值
            setToken(state, token) {
                state.token = token
                localStorage.token = token //同步存储token至localStorage
            },
            setUsername(state, username) {
                state.username = username
                localStorage.username = username //同步存储username至localStorage
            },
        },
        getters : {
            //获取token方法
            //判断是否有token,如果没有重新赋值，返回给state的token
            getToken(state) {
                if (!state.token) {
                    state.token = localStorage.getItem('token')
                }
                return state.token
            },
            getUsername(state) {
                if (!state.username) {
                    state.username = localStorage.getItem('username')
                }
                return state.username
            }
        },
        actions: {

        }
    });
    var product = new Vue({
        el: '#app',
        store: store,
        data() {
            return {
                //product info
                product: {
                    name: 'ProductsName',
                    price: '$5.40',
                    currentPrice: '$3.2',
                    contributor: 'CHEN XU ZHU ZHAO',
                    tags: 'Python Java JavaScript',
                    status: 'final version',
                    saleVolume: '5000',
                    releaseDate: '2020/11/20',
                    recentUpdateDate: '2020/11/24',
                    description: 'This is about AI',
                    rating: 4.6,
                },

                //编辑信息
                edit: {
                    name: 'ProductsName',
                    currentPrice: '$3.2',
                    contributor: 'CHEN XU ZHU ZHAO',
                    tags: 'Python Java JavaScript',
                    status: 'final version',
                    description: 'This is about AI',
                },

                profileVisible: false,
                dialogTableVisible: false,
                dialogFormVisible: false,
                formLabelWidth: '120px',

                //上传文件
                //上传代码文件
                codeForm : {
                    productId: '',
                    description: '',
                    version: '',
                    status: '',
                    lang: '',
                },

                fileList: [{
                    name: 'food.jpeg',
                    url: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100'
                }, {
                    name: 'food2.jpeg',
                    url: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100'
                }],


                //all file datas
                dialogCodeVisible: false,

                artifacts : [
                    {
                        name: 'artifact1.jar',
                        url: '',
                    },
                    {
                        name: 'artifact2.jar',
                        url: '',
                    },
                    {
                        name: 'artifact3.jar',
                        url: '',
                    },
                    {
                        name: 'artifact4.jar',
                        url: '',
                    },
                ],

                codes: [
                    {
                        name: 'code1.java',
                        url: '',
                    },
                    {
                        name: 'code2.java',
                        url: '',
                    },
                    {
                        name: 'code3.java',
                        url: '',
                    },
                    {
                        name: 'code4.java',
                        url: '',
                    },
                ],
                tests: [
                    {
                        name: 'testcase1',
                        url: '',
                    },
                    {
                        name: 'testcase2',
                        url: '',
                    },
                    {
                        name: 'testcase3',
                        url: '',
                    },
                    {
                        name: 'testcase4',
                        url: '',
                    },
                ],
                documents: [
                    {
                        name: 'doc1.txt',
                        url: '',
                    },
                    {
                        name: 'doc2.txt',
                        url: '',
                    },
                    {
                        name: 'doc3.txt',
                        url: '',
                    },
                    {
                        name: 'doc4.txt',
                        url: '',
                    },
                ],
                others: [
                    {
                        name: 'product1.jar',
                        url: '',
                    },
                    {
                        name: 'product2.jar',
                        url: '',
                    },
                    {
                        name: 'product3.jar',
                        url: '',
                    },
                    {
                        name: 'product4.jar',
                        url: '',
                    },
                ],
                activeName: 'first',


                activeNames: ['1'],

                search: '',
                ruleForm: {
                    username: '',
                    password: '',
                },
                rules: {
                    username: [
                        {required: true, message: 'please input username', trigger: 'blur'}
                    ],
                    password: [
                        {required: true, message: 'please input password', trigger: 'blur'}
                    ],
                }
            }
        },
        methods: {
            handleClick(tab, event) {
                console.log(tab, event);
            },
            //上传source code
            clickAdd: function () {
                this.dialogCodeVisible = true;
            },

            //通过onchanne触发方法获得文件列表
            handleChange(file, fileList) {
                this.fileList = fileList;
                console.log(fileList)
            },

            upload(){
                let fd = new FormData();
                this.fileList.forEach(item=>{
                    //文件信息中raw才是真的文件
                    fd.append("files",item.raw);
                    //console.log(item.raw)
                })
                axios.post('/uploadUi',fd).then(res=>{
                    if (res.data.code === 200) {
                        //console.log(res);
                        this.$message('上传成功')
                    }else{
                        this.$message('失败')
                    }
                })
            },


            //edit info
            submit: function () {
                this.profileVisible = false;

                //将用户修改后的表单信息更新到个人信息
                this.product.name = this.edit.name;
                this.product.description = this.edit.description;
                this.product.tags = this.edit.tags;
                this.product.status = this.edit.status;
                this.product.contributor = this.edit.contributor;

                //发送修改后的信息
                let fd = new FormData();
                fd.append("name", this.product.name);
                fd.append("description", this.product.description);
                fd.append("contributor", this.product.contributor);
                fd.append("tags", this.product.tags);
                fd.append("status", this.product.status);

                axios.post('/productDetail', fd).then(res => {
                    if (res.data.code === 200) {
                        //console.log(res);
                        this.$message('上传成功')
                    } else {
                        this.$message('失败')
                    }
                })

            },

            cancel: function () {
                this.profileVisible = false;
            },

            editInfo: function () {
                this.profileVisible = true;
                // 将原始个人信息显示在表单上
                this.edit.name = this.product.name;
                this.edit.description = this.product.description;
                this.edit.tags = this.product.tags;
                this.edit.status = this.product.status;
                this.edit.contributor = this.product.contributor;
            },

            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        axios({
                            method: 'post',
                            url: '/login_2.0',
                            data: qs.stringify({
                                'username': this.ruleForm.username,
                                'password': this.ruleForm.password,
                            }),
                            headers: {
                                'Content-type': 'application/x-www-form-urlencoded;charset=utf-8',
                                "token": " "
                            }
                        }).then(res => {  //res是返回结果
                            if (res.data['code'] === 200) {
                                this.$store.commit('setToken', JSON.stringify(res.data.token));
                                this.$message({
                                    message: '登录成功' + store.getters.getToken,
                                    type: 'success'
                                })
                            } else {
                                this.$message({
                                    message: '用户名或者密码错误',
                                    type: 'warning'
                                })
                            }
                        }).catch(err => { //请求失败就会捕获报错信息
                            console.log('服务器连接失败');
                            console.log(err);
                            this.$message({
                                message: '服务器连接失败',
                                type: 'warning'
                            })
                        })
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
        }
    });

</script>
</body>

</html>
